<!DOCTYPE html>
<html lang="en">

<head>
    <title>Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <ul class="navbar">
        <li><a href="{{ url_for('home') }}">Home</a></li>
        <li><a class="active" href="{{ url_for('booking') }}">Book Room</a></li>
        <li><a href="#contact">Contact</a></li>
        <li><a href="{{ url_for('information') }}">Information</a></li>
    </ul>
    <h1>Room Booking</h1>


    <!--Create links to change the page in the tab bar-->
    <div class="tab">
        <button class="tablinks" onclick="OpenDay(event, 'Monday')">Mon</button>
        <button class="tablinks" onclick="OpenDay(event, 'Tuesday')">Tue</button>
        <button class="tablinks" onclick="OpenDay(event, 'Wednesday')">Wed</button>
        <button class="tablinks" onclick="OpenDay(event, 'Thursday')">Thu</button>
        <button class="tablinks" onclick="OpenDay(event, 'Friday')">Fri</button>
    </div>

    <!--The content of the tabs-->
    <form action="/submit_booking" method="post">
    <div id="Monday" class="tabcontent"> 
            <table class="tableAvailability">
                <th>Time</th>
                <th>Availability</th>
                {% for timeslot in ['07:00 - 08:00', '08:00 - 09:00', '09:00 - 10:00', '10:00 - 11:00', '11:00 - 12:00', '12:00 - 13:00', '13:00 - 14:00', '14:00 - 15:00', '15:00 - 16:00'] %}
                <tr>
                    <td>{{ timeslot }}</td>
                    <td><input type="checkbox" id="checkbox-{{loop.index}}" name="timeslots" value="{{ timeslot }}" onclick="displayCheckbox()"></td>
                </tr>
                {% endfor %}
            </table>
    </div>
    
    <div id="Tuesday" class="tabcontent">
            <table class="tableAvailability">
                <th>Time</th>
                <th>Availability</th>
                {% for timeslot in ['07:00 - 08:00', '08:00 - 09:00', '09:00 - 10:00', '10:00 - 11:00', '11:00 - 12:00', '12:00 - 13:00', '13:00 - 14:00', '14:00 - 15:00', '15:00 - 16:00'] %}
                <tr>
                    <td>{{ timeslot }}</td>
                    <td><input type="checkbox" id="checkbox-{{loop.index}}" data-timeslot="{{ timeslot }}" onclick="displayCheckbox()">></td>
                </tr>
                {% endfor %}
            </table>
    </div>

    <div id="Wednesday" class="tabcontent">
       
            <table class="tableAvailability">
                <th>Time</th>
                <th>Availability</th>
                {% for timeslot in ['07:00 - 08:00', '08:00 - 09:00', '09:00 - 10:00', '10:00 - 11:00', '11:00 - 12:00', '12:00 - 13:00', '13:00 - 14:00', '14:00 - 15:00', '15:00 - 16:00'] %}
                <tr>
                    <td>{{ timeslot }}</td>
                    <td><input type="checkbox" id="checkbox-{{loop.index}}" data-timeslot="{{ timeslot }}"
                            onclick="displayCheckbox()">
                        <!-- Checkbox to enable the button --></td>
                </tr>{% endfor %}
            </table>
    </div>

    <div id="Thursday" class="tabcontent">
        
            <table class="tableAvailability">
                <th>Time</th>
                <th>Availability</th>
                {% for timeslot in ['07:00 - 08:00', '08:00 - 09:00', '09:00 - 10:00', '10:00 - 11:00', '11:00 - 12:00', '12:00 - 13:00', '13:00 - 14:00', '14:00 - 15:00','15:00 - 16:00'] %}
                <tr>
                    <td>{{ timeslot }}</td>
                    <td><input type="checkbox" id="checkbox-{{loop.index}}" data-timeslot="{{ timeslot }}"
                            onclick="displayCheckbox()">
                        <!-- Checkbox to enable the button --></td>
                </tr>{% endfor %}
            </table>
    </div>

    <div id="Friday" class="tabcontent">
        
            <table class="tableAvailability">
                <th>Time</th>
                <th>Availability</th>
                {% for timeslot in ['07:00 - 08:00', '08:00 - 09:00', '09:00 - 10:00', '10:00 - 11:00', '11:00 - 12:00', '12:00 - 13:00', '13:00 - 14:00','14:00 - 15:00', '15:00 - 16:00'] %}
                <tr>
                    <td>{{ timeslot }}</td>
                    <td><input type="checkbox" id="checkbox-{{loop.index}}" data-timeslot="{{ timeslot }}"
                            onclick="displayCheckbox()">
                        <!-- Checkbox to enable the button --></td>
                </tr>{% endfor %}
            </table>
            </div>

            <button class="BookButton" type="button" id="bookButton" disabled onclick="displayAlert()">BOOK</button>
    <!-- Disable the button by default -->
        </form>
    
    <!--
            <tr>
                <td>08:00 - 09:00</td>
                <td><input type="checkbox" data-timeslot="2023-11-13T08:00" onclick="displayCheckbox()"></td>
            </tr>
            <tr>
                <td>09:00 - 10:00</td>
                <td><input type="checkbox" onclick="displayCheckbox()"></td>
            </tr>
            <tr>
                <td>10:00 - 11:00</td>
                <td><input type="checkbox" onclick="displayCheckbox()"></td>
            </tr>
            <tr>
                <td>11:00 - 12:00</td>
                <td><input type="checkbox" onclick="displayCheckbox()"></td>
            </tr>
            <tr>
                <td>12:00 - 13:00</td>
                <td><input type="checkbox" onclick="displayCheckbox()"></td>
            </tr>
            <tr>
                <td>13:00 - 14:00</td>
                <td><input type="checkbox" onclick="displayCheckbox()"></td>
            </tr>
            <tr>
                <td>14:00 - 15:00</td>
                <td><input type="checkbox" onclick="displayCheckbox()"></td>
            </tr>
            <tr>
                <td>15:00 - 16:00</td>
                <td><input type="checkbox" onclick="displayCheckbox()"></td>
            </tr>
        </table>
    </div>

    <div id="Tuesday" class="tabcontent">
        <table class="tableAvailability">
            <th>Time</th>
            <th>Availability</th>
            <tr>
                <td>07:00 - 08:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>08:00 - 09:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>09:00 - 10:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>10:00 - 11:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>11:00 - 12:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>12:00 - 13:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>13:00 - 14:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>14:00 - 15:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>15:00 - 16:00</td>
                <td>Reserved</td>
            </tr>
        </table>
    </div>

    <div id="Wednesday" class="tabcontent">
        <table class="tableAvailability">
            <th>Time</th>
            <th>Availability</th>
            <tr>
                <td>07:00 - 08:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>08:00 - 09:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>09:00 - 10:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>10:00 - 11:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>11:00 - 12:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>12:00 - 13:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>13:00 - 14:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>14:00 - 15:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>15:00 - 16:00</td>
                <td>Reserved</td>
            </tr>
        </table>
    </div>

    <div id="Thursday" class="tabcontent">
        <table class="tableAvailability">
            <th>Time</th>
            <th>Availability</th>
            <tr>
                <td>07:00 - 08:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>08:00 - 09:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>09:00 - 10:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>10:00 - 11:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>11:00 - 12:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>12:00 - 13:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>13:00 - 14:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>14:00 - 15:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>15:00 - 16:00</td>
                <td>Reserved</td>
            </tr>
        </table>
    </div>

    <div id="Friday" class="tabcontent">
        <table class="tableAvailability">
            <th>Time</th>
            <th>Availability</th>
            <tr>
                <td>07:00 - 08:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>08:00 - 09:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>09:00 - 10:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>10:00 - 11:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>11:00 - 12:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>12:00 - 13:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>13:00 - 14:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>14:00 - 15:00</td>
                <td>Reserved</td>
            </tr>
            <tr>
                <td>15:00 - 16:00</td>
                <td>Reserved</td>
            </tr>
        </table> -->
        <script>


            // javascript for checkbox
            function displayCheckbox() {
                // Get all checkboxes
                var checkboxes = document.querySelectorAll('input[type="checkbox"]');
    
                // Check if any checkbox is checked
                var checkedCount = Array.from(checkboxes).filter(checkbox => checkbox.checked).length;
    
                // Get the button
                var button = document.getElementById('bookButton');
    
                // Enable or disable the button based on whether any checkbox is checked
                button.disabled = checkedCount === 0 || checkedCount > 4;
                
                // set the value of the hidden input field for each checkbox
                checkboxes.forEach((checkbox, index) => {
                    var timeslotInput = document.getElementById('timeslot-' + (index + 1));
                    if (checkbox.checked) {
                        timeslotInput.value = checkbox.getAttribute('data-timeslot');
                    } else {
                        timeslotInput.value = '';
                     }
                });
            }
    
            function displayAlert() { // This function is called when the button is clicked
    
                // Get all checkboxes
                var checkboxes = document.querySelectorAll('input[type="checkbox"]');

                // Get the values of the checked checkboxes
                var checkedValues = Array.from(checkboxes)
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.value);
    
                // Check if any checkbox is checked
                var checkedCount = Array.from(checkboxes).filter(checkbox => checkbox.checked).length;
                // Get current total from localStorage and convert it to a number
                var totalChecked = Number(localStorage.getItem("checked")) || 0;
                // Add checkedCount to the total
                totalChecked += checkedCount;
    
                // Store the new total in localStorage
                localStorage.setItem("checked", totalChecked);
                // Log the new total to the console
                console.log(localStorage.getItem("checked"));
                
                    // Send the checked values to the server
                fetch('/submit_booking', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        timeslots: checkedValues, // Include the array of checked values
                        RoomNO: '4118' // Replace with actual room number
                }),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        alert("Room booked!");
    })
    .catch((error) => {
        console.error('Error:', error);
    });
         }
    
            // javascript for tabbar
            function OpenDay(evt, day) {
                var i, tabcontent, tablinks;
                // get all elements with class="tabcontent" and hide them
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                // Get all elements with class="tablinks" and remove the class "active"
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                // Show the current tab, and add an "active" class to the button that opened the tab
                document.getElementById(day).style.display = "block";
                evt.currentTarget.className += " active";
            }
        </script>
</body>

</html>